---
title: Polygon Clip
layout: post
categories: joker
tags: ''
---
Clipper这个库真的有用么。
[http://www.angusj.com/delphi/clipper.php](http://www.angusj.com/delphi/clipper.php)

接了一下，本来是想它只支持整型，那么我扩大一个scale，比如1000倍，就有4位有效数字。然后use_xyz，利用z坐标绑定标记，然后复原出曲线段，用这个库来做clip的。

大致接好后随手输了一个test case，非常简单，对下面这个path做simplify。

    @!
    @moveTo 215.000000, 289.000000;
    @lineTo 237.000000, 167.000000;
    @lineTo 374.000000, 135.000000;
    @lineTo 434.000000, 219.000000;
    @lineTo 394.000000, 285.000000;
    @lineTo 459.000000, 138.000000;
    @lineTo 280.000000, 129.000000;
    @lineTo 215.000000, 289.000000;
    @moveTo 294.000000, 259.000000;
    @lineTo 347.000000, 224.000000;
    @lineTo 364.000000, 313.000000;
    @lineTo 277.000000, 394.000000;
    @lineTo 94.000000, 336.000000;
    @lineTo 107.000000, 201.000000;
    @lineTo 272.000000, 294.000000;
    @lineTo 130.000000, 385.000000;
    @lineTo 362.000000, 390.000000;
    @lineTo 294.000000, 259.000000;
    @@

然后clipper给我的结果是这样的：

    
    @!
    @moveTo 283.122009, 388.299988;
    @lineTo 277.000000, 394.000000;
    @lineTo 257.256989, 387.743011;
    @lineTo 283.122009, 388.299988;
    @@
    @!
    @moveTo 362.000000, 390.000000;
    @lineTo 283.122009, 388.299988;
    @lineTo 355.737000, 320.692993;
    @lineTo 362.000000, 390.000000;
    @@
    @!
    @moveTo 434.000000, 219.000000;
    @lineTo 394.000000, 285.000000;
    @lineTo 427.319000, 209.647003;
    @lineTo 434.000000, 219.000000;
    @@
    @!
    @moveTo 94.000000, 336.000000;
    @lineTo 107.000000, 201.000000;
    @lineTo 272.000000, 294.000000;
    @lineTo 169.246994, 359.848999;
    @lineTo 94.000000, 336.000000;
    @@
    @!
    @moveTo 130.000000, 385.000000;
    @lineTo 169.246994, 359.848999;
    @lineTo 257.256989, 387.743011;
    @lineTo 130.000000, 385.000000;
    @@
    @!
    @moveTo 347.000000, 224.000000;
    @lineTo 364.000000, 313.000000;
    @lineTo 355.737000, 320.692993;
    @lineTo 347.000000, 224.000000;
    @@
    @!
    @moveTo 374.000000, 135.000000;
    @lineTo 237.000000, 167.000000;
    @lineTo 280.000000, 129.000000;
    @lineTo 459.000000, 138.000000;
    @lineTo 427.319000, 209.647003;
    @lineTo 374.000000, 135.000000;
    @@

呵呵哒，还是算了吧。为啥有人写这个东西的wrapper给qt，qt的虽然做的不好，但至少基本能保证正确性。